erDiagram
  USER {
    uuid id
    text email
    text display_name
    text global_role
    datetime created_at
    datetime last_login_at
  }

  ORG {
    uuid id
    text name
    text billing_email
    text billing_address
    text billing_phone
    datetime created_at
  }

  ACCOUNT {
    uuid id
    uuid org_id "legacy"
    uuid parent_org_id "primary"
    uuid owner_user_id
    text name
    text description
    text plan
    text status
    text billing_email
    jsonb settings
    boolean is_default
    datetime created_at
  }

  MEMBERSHIP {
    uuid id
    uuid user_id
    uuid account_id
    text role
    datetime created_at
  }

  SONG {
    uuid id
    uuid account_id
    text title
    text status
    datetime created_at
    datetime updated_at
  }

  SONG_VERSION {
    uuid id
    uuid song_id
    text label
    boolean is_final
    text lyrics_md
    datetime created_at
  }

  SONG_AUTHOR {
    uuid id
    uuid song_id
    uuid user_id
    text role
    numeric split_pct
    datetime created_at
  }

  SONG_ACCESS {
    uuid id
    uuid song_id
    uuid account_id
    text permission
    datetime created_at
  }

  LINE_CONTRIBUTION {
    uuid id
    uuid song_version_id
    uuid user_id
    int line_number
    text note
    datetime created_at
  }

  RECORDING {
    uuid id
    uuid song_id
    uuid user_id
    text storage_key
    int duration_seconds
    text take_label
    datetime created_at
  }

  SONG_OWNERSHIP_HISTORY {
    uuid id
    uuid song_id
    uuid from_account_id
    uuid to_account_id
    text method
    datetime effective_at
  }

  RIGHTS_HOLDER {
    uuid id
    uuid song_id
    text holder_type
    uuid holder_id
    text rights_type
    datetime start_at
    datetime end_at
  }

  TAG {
    uuid id
    text name
  }

  SONG_TAG {
    uuid id
    uuid song_id
    uuid tag_id
  }

  GENRE {
    uuid id
    text name
  }

  SONG_GENRE {
    uuid id
    uuid song_id
    uuid genre_id
  }

  %% Relationships
  ORG ||--o{ ACCOUNT : "parent_org_id (primary)"
  ORG ||--o{ ACCOUNT : "org_id (legacy)"
  ACCOUNT ||--o{ MEMBERSHIP : has_members
  USER ||--o{ MEMBERSHIP : joins
  ACCOUNT ||--o{ SONG : owns
  SONG ||--o{ SONG_VERSION : versions
  SONG ||--o{ SONG_AUTHOR : has_authors
  USER ||--o{ SONG_AUTHOR : credited_as
  SONG ||--o{ SONG_ACCESS : shared_with
  ACCOUNT ||--o{ SONG_ACCESS : gets_access
  SONG_VERSION ||--o{ LINE_CONTRIBUTION : has_lines_by
  USER ||--o{ LINE_CONTRIBUTION : contributes
  SONG ||--o{ RECORDING : has_recordings
  USER ||--o{ RECORDING : records
  SONG ||--o{ SONG_OWNERSHIP_HISTORY : transfer_log
  ACCOUNT ||--o{ SONG_OWNERSHIP_HISTORY : from_account
  ACCOUNT ||--o{ SONG_OWNERSHIP_HISTORY : to_account
  SONG ||--o{ RIGHTS_HOLDER : rights
  ORG ||--o{ RIGHTS_HOLDER : may_hold
  ACCOUNT ||--o{ RIGHTS_HOLDER : may_hold
  SONG ||--o{ SONG_TAG : tagged
  TAG ||--o{ SONG_TAG : tag_map
  SONG ||--o{ SONG_GENRE : genre_map
  GENRE ||--o{ SONG_GENRE : genre_map
