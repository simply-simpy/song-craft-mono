# Database Schema Documentation Strategy

## ğŸ“Š **Two-Tier Documentation System**

### 1. **`schema.dbml` - Current Implementation**

- **Source**: Auto-generated from `songcraft-api/src/schema.ts`
- **Purpose**: Shows exactly what's in your database right now
- **Generated by**: `npm run generate-dbml`
- **View at**: https://dbdiagram.io/
- **When to use**:
  - Debugging database issues
  - Onboarding new developers
  - API development reference
  - Database migrations

### 1b. **`schema-with-relations.dbml` - With Relationships**

- **Source**: Enhanced version with foreign key relationships
- **Purpose**: Shows current database schema WITH all relationships/connectors
- **Generated by**: `npm run generate-dbml-relations`
- **View at**: https://dbdiagram.io/ (paste the content)
- **When to use**:
  - Understanding data relationships
  - Database design discussions
  - Visualizing foreign key constraints

### 2. **Mermaid ERDs - Design & Architecture**

- **Source**: Manually crafted in `diagrams/09-db/`
- **Purpose**: Shows the intended architecture and design decisions
- **Generated by**: `npm run build` (Mermaid diagrams)
- **View at**: `/public/generated/` (local) or your hosted docs
- **When to use**:
  - Architecture discussions
  - Planning new features
  - Stakeholder presentations
  - Design documentation

## ğŸ”„ **Workflow Integration**

### **Development Cycle**

1. **Design Phase**: Update Mermaid ERDs with proposed changes
2. **Implementation**: Modify Drizzle schema in `src/schema.ts`
3. **Sync**: Run `npm run generate-dbml` to update DBML
4. **Review**: Compare DBML vs Mermaid to ensure alignment
5. **Deploy**: Apply changes to database

### **Commands**

```bash
# Generate current schema from Drizzle
npm run generate-dbml

# Generate both DBML and Mermaid
npm run generate-erd

# Build all Mermaid diagrams
npm run build

# View interactive database
npm run db:studio
```

## ğŸ“ **File Organization**

```
songcraft-api/
â”œâ”€â”€ src/schema.ts              # Drizzle schema definitions
â”œâ”€â”€ schema.dbml               # Auto-generated current schema
â”œâ”€â”€ schema.mermaid            # Auto-generated Mermaid (basic)
â””â”€â”€ scripts/
    â”œâ”€â”€ generate-dbml.ts      # DBML generator
    â””â”€â”€ generate-erd.ts       # ERD generator

diagrams/09-db/
â”œâ”€â”€ core-identity-erd.mermaid     # Core identity design
â”œâ”€â”€ account-user-songs-erd.mermaid # Main relationships
â”œâ”€â”€ all-erds.mermaid              # Comprehensive overview
â””â”€â”€ billing-subscriptions-erd.mermaid # Billing design

public/generated/              # Built Mermaid diagrams
â”œâ”€â”€ core-identity-erd.png
â”œâ”€â”€ account-user-songs-erd.png
â””â”€â”€ ...
```

## ğŸ¯ **Best Practices**

### **Keep DBML Updated**

- Run `npm run generate-dbml` after schema changes
- Commit `schema.dbml` to version control
- Use for API documentation and debugging

### **Maintain Mermaid ERDs**

- Update when making architectural decisions
- Include business context and relationships
- Use for team communication and planning

### **Sync Both**

- Compare DBML vs Mermaid regularly
- Ensure they reflect the same reality
- Use discrepancies to identify missing features

## ğŸš€ **Quick Reference**

| Need                      | Use                          | Command                           |
| ------------------------- | ---------------------------- | --------------------------------- |
| Current database schema   | `schema.dbml`                | `npm run generate-dbml`           |
| Schema with relationships | `schema-with-relations.dbml` | `npm run generate-dbml-relations` |
| Architecture design       | Mermaid ERDs                 | `npm run build`                   |
| Interactive exploration   | Drizzle Studio               | `npm run db:studio`               |
| Both formats              | `schema.dbml` + Mermaid      | `npm run generate-erd`            |

## ğŸ” **Viewing Your Schemas**

- **DBML**: https://dbdiagram.io/ (paste `schema.dbml` content)
- **Mermaid**: http://localhost:3000/generated/ (local) or https://mermaid.live/
- **Interactive**: https://local.drizzle.studio (Drizzle Studio)
